# Requirements Document

## Introduction

AgriChain is an Explainable AI (XAI) "Trust Engine" that eliminates post-harvest crop loss for Indian farmers by providing personalized, actionable harvest timing and market recommendations. The system synthesizes hyper-local satellite data, weather forecasts, and live market prices through a biological rules engine (GraphRAG) to deliver plain-language advice optimized for low-end phones.

The core problem: Farmers lose money by harvesting at the wrong time (before storms) or selling at the wrong place (flooded local markets). AgriChain acts as both a personalized Agronomist and Economist, using Generative UI to stream recommendations like "Harvest today, rain is coming, and Nagpur Mandi is paying ₹5 extra" directly to farmers via a Progressive Web App.

## Glossary

- **AgriChain**: The complete XAI Trust Engine system for harvest optimization
- **Trust_Engine**: The AI orchestration layer that synthesizes data sources and generates explainable recommendations
- **GraphRAG**: Graph-based Retrieval Augmented Generation using Neo4j for biological rules
- **Generative_UI**: Streaming UI components generated by AI using Vercel AI SDK streamUI
- **Mandi**: Indian agricultural wholesale market
- **NDVI**: Normalized Difference Vegetation Index - satellite measure of crop health
- **AGROVOC**: FAO's agricultural vocabulary ontology
- **ICAR**: Indian Council of Agricultural Research
- **Demo_Cache**: Supabase-based pre-fetched satellite data layer for 2-second response times
- **Biological_Rules_Engine**: Neo4j graph database containing crop-specific post-harvest rules
- **Orchestrator_Model**: NVIDIA NIM API (Kimi K2.5 or Llama-3-70B) for AI reasoning
- **XAI**: Explainable AI - transparent reasoning that farmers can understand and trust

## Requirements

### Requirement 1: XAI Trust Engine Core

**User Story:** As a farmer, I want to receive explainable harvest and market recommendations, so that I can trust the advice and make informed decisions about my crops.

#### Acceptance Criteria

1. THE Trust_Engine SHALL synthesize soil moisture data, crop health indicators, weather forecasts, and market prices into a single recommendation
2. WHEN generating a recommendation, THE Trust_Engine SHALL provide plain-language explanations for each decision factor
3. THE Trust_Engine SHALL use the Biological_Rules_Engine to validate recommendations against ICAR post-harvest guidelines
4. THE Trust_Engine SHALL stream recommendations using Generative_UI to ensure progressive loading on slow networks
5. FOR ALL recommendations, THE Trust_Engine SHALL cite specific data sources (satellite readings, weather forecasts, market prices) in the explanation

### Requirement 2: Hyper-Local Satellite Data Integration

**User Story:** As a farmer, I want the system to analyze satellite data for my specific field, so that I receive accurate crop readiness assessments.

#### Acceptance Criteria

1. WHEN a field location is provided, THE AgriChain SHALL query NASA_USDA/SMAP_GLOBAL dataset for soil moisture levels
2. WHEN assessing crop readiness, THE AgriChain SHALL calculate NDVI from COPERNICUS/S2_SR_HARMONIZED Sentinel-2 imagery
3. WHEN analyzing rainfall patterns, THE AgriChain SHALL retrieve historical precipitation from UCSB-CHG/CHIRPS/DAILY dataset
4. THE AgriChain SHALL integrate ISRO VEDAS agricultural drought vulnerability data for Maharashtra/Nagpur regions
5. WHERE Demo_Cache contains recent satellite data, THE AgriChain SHALL serve cached results within 2 seconds
6. IF satellite data is not cached, THEN THE AgriChain SHALL fetch from Google Earth Engine and update Demo_Cache

### Requirement 3: Real-Time Weather Forecasting

**User Story:** As a farmer, I want to know if rain or storms are coming, so that I can harvest before my crops are damaged.

#### Acceptance Criteria

1. THE AgriChain SHALL integrate OpenWeatherMap One Call API 3.0 for 8-day weather forecasts
2. WHEN a storm is predicted within 48 hours, THE Trust_Engine SHALL recommend immediate harvest if crops are ready
3. THE AgriChain SHALL extract precipitation probability, temperature, and humidity from weather API responses
4. WHEN weather conditions threaten crop quality, THE Trust_Engine SHALL explain the specific risk in plain language
5. THE AgriChain SHALL refresh weather data every 6 hours to maintain forecast accuracy

### Requirement 4: Live Market Price Intelligence

**User Story:** As a farmer, I want to know which Mandi is paying the best price, so that I can maximize my profit when selling crops.

#### Acceptance Criteria

1. THE AgriChain SHALL integrate Agmarknet API from Data.gov.in for live Mandi prices
2. WHEN multiple Mandis are available, THE Trust_Engine SHALL compare prices and recommend the highest-paying market
3. THE AgriChain SHALL display price differences in rupees (e.g., "Nagpur Mandi is paying ₹5 extra per kg")
4. WHERE Agmarknet API is unavailable, THE AgriChain SHALL fall back to AIKosh agricultural embeddings
5. THE AgriChain SHALL update market prices daily to reflect current trading conditions

### Requirement 5: Biological Rules Engine (GraphRAG)

**User Story:** As a farmer, I want recommendations based on proven agricultural science, so that I follow best practices for post-harvest handling.

#### Acceptance Criteria

1. THE Biological_Rules_Engine SHALL use Neo4j AuraDB to store crop-specific post-harvest rules
2. THE Biological_Rules_Engine SHALL implement AGROVOC ontology as the knowledge graph structure
3. THE AgriChain SHALL load ICAR post-harvest manual rules for Tomatoes and Onions into Neo4j
4. WHEN environmental conditions are provided, THE Biological_Rules_Engine SHALL query relevant spoilage rules (e.g., "Tomatoes spoil in 48 hours at >30°C and >80% humidity")
5. THE Trust_Engine SHALL combine biological rules with real-time data to generate time-sensitive recommendations
6. THE Biological_Rules_Engine SHALL support graph traversal queries to find related agricultural concepts

### Requirement 6: Progressive Web App for Low-End Phones

**User Story:** As a farmer with a basic smartphone and slow internet, I want to access AgriChain quickly, so that I can make timely decisions without frustration.

#### Acceptance Criteria

1. THE AgriChain SHALL be built as a Next.js 14+ Progressive Web App using App Router
2. THE AgriChain SHALL use TypeScript in strict mode for type safety
3. THE AgriChain SHALL style components with Tailwind CSS for minimal bundle size
4. THE AgriChain SHALL use shadcn/ui accessible components and lucide-react icons
5. THE AgriChain SHALL achieve 2-second response time for cached recommendations
6. THE AgriChain SHALL support offline access to previously loaded recommendations
7. THE AgriChain SHALL optimize images and assets for slow 3G networks
8. THE AgriChain SHALL display loading states during data streaming to provide feedback

### Requirement 7: Generative UI Streaming

**User Story:** As a farmer, I want to see recommendations appear progressively, so that I can start reading advice while the system finishes loading.

#### Acceptance Criteria

1. THE AgriChain SHALL use Vercel AI SDK streamUI for Generative UI implementation
2. WHEN generating recommendations, THE Trust_Engine SHALL stream UI components progressively
3. THE AgriChain SHALL display text content before loading charts or supplementary data
4. THE AgriChain SHALL use NVIDIA NIM API (Kimi K2.5 or Llama-3-70B) as the Orchestrator_Model
5. THE AgriChain SHALL render recommendations as plain-language cards, not raw data tables
6. THE AgriChain SHALL stream explanations in order: decision summary, then supporting data, then detailed reasoning

### Requirement 8: Demo Performance with Caching Layer

**User Story:** As a demo user, I want instant responses, so that I can evaluate AgriChain's capabilities without waiting for satellite data processing.

#### Acceptance Criteria

1. THE AgriChain SHALL use Supabase PostgreSQL as the Demo_Cache for pre-fetched satellite data
2. WHEN satellite data is requested, THE AgriChain SHALL check Demo_Cache before querying Google Earth Engine
3. THE Demo_Cache SHALL reduce satellite data retrieval time from 30 seconds to 2 seconds
4. THE AgriChain SHALL populate Demo_Cache with sample data for Maharashtra/Nagpur region
5. THE AgriChain SHALL cache NDVI calculations, soil moisture readings, and rainfall history
6. THE Demo_Cache SHALL expire entries after 7 days to ensure data freshness

### Requirement 9: Multi-Crop Support (Tomatoes and Onions)

**User Story:** As a farmer growing tomatoes or onions, I want crop-specific advice, so that I follow the correct post-harvest practices for my crop type.

#### Acceptance Criteria

1. THE AgriChain SHALL support Tomatoes as the first crop type with specific biological rules
2. THE AgriChain SHALL support Onions as the second crop type with specific biological rules
3. WHEN a crop type is selected, THE Biological_Rules_Engine SHALL retrieve crop-specific spoilage thresholds
4. THE Trust_Engine SHALL adjust recommendations based on crop-specific temperature and humidity tolerances
5. THE AgriChain SHALL extract and load ICAR manual rules for both Tomatoes and Onions into Neo4j

### Requirement 10: Explainability and Trust

**User Story:** As a farmer, I want to understand why AgriChain is making a recommendation, so that I can trust the advice and explain it to my family.

#### Acceptance Criteria

1. THE Trust_Engine SHALL provide explanations in plain Hindi or English language
2. WHEN displaying a recommendation, THE AgriChain SHALL show the reasoning chain: weather → crop readiness → market prices → final advice
3. THE AgriChain SHALL cite specific data points (e.g., "Soil moisture is 85%, NDVI is 0.7, rain forecast is 80%")
4. THE AgriChain SHALL avoid technical jargon in farmer-facing explanations
5. THE Trust_Engine SHALL highlight the most important factor influencing each recommendation
6. FOR ALL recommendations, THE AgriChain SHALL display confidence levels based on data quality and recency